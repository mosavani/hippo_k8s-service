# tests/values/rollout-canary.yml
# Argo Rollout canary with HPA â€” rollout replaces Deployment
image:
  repository: gcr.io/my-project/hippo-api
  tag: "2.1.0"

global:
  env: prod
  componentName: hippo-api

service:
  replicaCount: 4
  port: 80
  targetPort: 8080
  liveness:
    enabled: true
    path: /health
  readiness:
    enabled: true
    path: /ready

rollout:
  enabled: true
  autoPromote: false
  maxSurge: 25
  maxUnavailable: 0
  progressDeadlineSeconds: 600
  progressDeadlineAbort: true
  steps:
    - setWeight: 10
    - pause:
        duration: 60s
    - setWeight: 30
    - pause:
        duration: 120s
    - setWeight: 50
    - pause:
        duration: 120s
    - setWeight: 100

hpa:
  enabled: true
  minReplicas: 4
  maxReplicas: 50
  targetCPUUtilizationPercentage: 60

pdb:
  enabled: true
  minAvailable: 2

affinity:
  podAntiAffinity: hard

ingress:
  enabled: true
  className: "gce"
  annotations:
    kubernetes.io/ingress.allow-http: "false"
  host: api.hippo.example.com
  path: /

networkPolicy:
  enabled: true
  ingressNamespace: kube-system

resources:
  requests:
    cpu: 500m
    memory: 512Mi
  limits:
    memory: 1Gi
